<?php if($_SERVER["REQUEST_METHOD"]=="POST"){$cp="Province_Districts";session_start();$present_aid=$_POST['consultancy_list'];$cid=$_POST['province'];require_once "../../database.php";require_once "../../tables.php";$db=Database::Instance();$previous_aid=array();$auth_result=$db->SelectByCriteria('Province_Districts','did','pid',[$cid]);foreach($auth_result as $datas){$previous_aid[]=$datas->did;}if($present_aid==null){if($previous_aid!=null){foreach($previous_aid as $data){$db->CustomQuery("DELETE FROM Province_Districts WHERE pid={$cid} AND did={$data}");}}$_SESSION['message']='Changes Made Successfully';echo '<script type="text/javascript">';echo 'window.location.href="https://www.consultancynepal.com/cnbackend/showprovince";';echo '</script>';}elseif($previous_aid==null&&$present_aid!=null){foreach($present_aid as $data){$db->Insert($cp,['did'=>$data,'pid'=>$cid]);}$_SESSION['message']='Changes Made Successfully';echo '<script type="text/javascript">';echo 'window.location.href="https://www.consultancynepal.com/cnbackend/showprovince";';echo '</script>';}else{if(count($present_aid)>count($previous_aid)){$inserting_aid=array_diff($present_aid,$previous_aid);foreach($inserting_aid as $aids){$aut_book_params=['did'=>$aids,'pid'=>$cid];$db->Insert($cp,$aut_book_params);}$result=$db->SelectByCriteria('Province_Districts','did','pid',[$cid]);$table_authors=array();foreach($result as $data){$table_authors[]=$data->did;}$re_data=array_diff($table_authors,$present_aid);if(count($re_data)!=0){foreach($re_data as $data){$obj->delete($cp,$where);$db->CustomQuery("DELETE FROM Province_Districts WHERE pid={$cid} AND did={$data}");}}$_SESSION['message']='Districts Added';echo '<script type="text/javascript">';echo 'window.location.href="https://www.consultancynepal.com/cnbackend/showprovince";';echo '</script>';}elseif(count($previous_aid)>count($present_aid)){$new_a=array_diff($present_aid,$previous_aid);if(count($new_a)!=0){foreach($new_a as $aids){$aut_book_params=['did'=>$aids,'pid'=>$cid];$db->Insert($cp,$aut_book_params);}$result=$db->SelectByCriteria($cp,'did','pid',[$cid]);$table_authors=array();foreach($result as $data){$table_authors[]=$data->did;}$re_data=array_diff($table_authors,$present_aid);if(count($re_data)!=0){foreach($re_data as $data){$db->CustomQuery("DELETE FROM Province_Districts WHERE pid={$cid} AND did={$data}");}}}else{$new_b=array_diff($previous_aid,$present_aid);if(count($new_b)!=0){foreach($new_b as $data){$db->CustomQuery("DELETE FROM Province_Districts WHERE pid={$cid} AND did={$data}");}}}$_SESSION['message']='Districts Added';echo '<script type="text/javascript">';echo 'window.location.href="https://www.consultancynepal.com/cnbackend/showprovince";';echo '</script>';}elseif(count($present_aid)==count($previous_aid)){$diff=array_diff($present_aid,$previous_aid);if(count($diff)!=null){foreach($diff as $aids){$aut_book_params=['did'=>$aids,'pid'=>$cid];$db->Insert($cp,$aut_book_params);}$result=$db->SelectByCriteria($cp,'did','pid',[$cid]);$table_authors=array();foreach($result as $data){$table_authors[]=$data->did;}$re_data=array_diff($table_authors,$present_aid);if(count($re_data)!=0){foreach($re_data as $data){$db->CustomQuery("DELETE FROM Province_Districts WHERE pid={$cid} AND did={$data}");}}$_SESSION['message']='Districts Added';echo '<script type="text/javascript">';echo 'window.location.href="https://www.consultancynepal.com/cnbackend/showprovince";';echo '</script>';}}}}